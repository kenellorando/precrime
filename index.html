<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Map demo</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <style>
        /* Always set the map height explicitly to define the size of the div
                 * element that contains the map. */

        #map {
            height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>

</head>

<body>
    <button id="getLocationBtn">Get Location</button>
    <div id="map"></div>
    <div id="coords"></div>

    <script>
        var map, infoWindow;

        function setLocation() {
            navigator.geolocation.watchPosition(function (position) {

                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                console.log("Refreshing position: " + pos.lat + " " + pos.lng);
                document.getElementById("coords").append("Refreshing position: " + pos.lat + " " + pos.lng);
                document.getElementById("coords").append("\n");


                infoWindow.setPosition(pos);
                infoWindow.setContent('Location found.');
                infoWindow.open(map);
                map.setCenter(pos);
            }, function () {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        }

        function initMap() {
            infoWindow = new google.maps.InfoWindow;
            setLocation();

            $.getJSON('https://data.cityofchicago.org/resource/d62x-nvdr.json', function (data) {
                console.log(data);
                var la = data[0].latitude;
                var lo = data[0].longitude;
                console.log(la, lo);
                la = parseFloat(la).toFixed(3);
                lo = parseFloat(lo).toFixed(3);

                var uluru = {
                    lat: parseFloat(la),
                    lng: parseFloat(lo)
                };

                map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: uluru
            });


                for (i = 0; i < data.length; i++) {
                    var crime = data[i].primary_type
                    var la = data[i].latitude
                    var lo = data[i].longitude
                    la = parseFloat(la).toFixed(3);
                    lo = parseFloat(lo).toFixed(3);
                    var uluru = {
                        lat: parseFloat(la),
                        lng: parseFloat(lo)
                    }
                    var m = new Date();
                    if ((parseFloat(data[i].date.substring(5, 7)) == (m.getMonth() + 1)) &&
                        (data[i].primary_type == "ROBBERY" || data[i].primary_type == "ASSAULT")) {
                        var marker = new google.maps.Marker({
                            position: uluru,
                            map: map
                        });
                    }
                }
            });

        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBYe_dx1Qi7AMSplAwgxscYbkLo32ZdpPc&callback=initMap">
    </script>
</body>


</html>